#!/bin/bash

## Copyright (C) 2012 - 2020 ENCRYPTED SUPPORT LP <adrelanos@riseup.net>
## See the file COPYING for copying conditions.

if [ -f /usr/lib/helper-scripts/pre.bsh ]; then
   source /usr/lib/helper-scripts/pre.bsh
fi

set -e

true "
#####################################################################
## INFO: BEGIN: $DPKG_MAINTSCRIPT_PACKAGE $DPKG_MAINTSCRIPT_NAME $@
#####################################################################
"

case "$1" in
   configure)
      true "INFO: Configuring $DPKG_MAINTSCRIPT_PACKAGE..."

      true 'INFO: Working around: "sudo: unable to resolve host host"'
      if [ -f /etc/hostname ]; then
         my_host_name="$(cat "/etc/hostname")" || true
         if [ ! "$my_host_name" = "" ]; then
            hostname "$my_host_name" || true
         fi
      fi

      ## 70_dpkg_origins {{

      ## || true to support re-running the script

      ## Get rid of old symlink.
      unlink /etc/dpkg/origins/default || true

      ln -s /etc/dpkg/origins/whonix /etc/dpkg/origins/default || true

      ## 70_dpkg_origins }}

      true "INFO: End configuring $DPKG_MAINTSCRIPT_PACKAGE."

      ;;

   *)
      ;;
esac

true "INFO: debhelper beginning here."

#DEBHELPER#

true "INFO: Done with debhelper."

true "
#####################################################################
## INFO: END  : $DPKG_MAINTSCRIPT_PACKAGE $DPKG_MAINTSCRIPT_NAME $@
#####################################################################
"

## Explicitly "exit 0", so eventually trapped errors can be ignored.
exit 0
